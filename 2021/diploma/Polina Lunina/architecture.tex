Предложенный в предыдущей дипломной работе подход предназначен для решения задач анализа строковых данных, обладающих некоторого рода синтаксической структурой, которая, наряду с непосредственно символами рассматриваемых строк, является важным источником информации о каких-либо характеристиках входных данных, но при этом оказывается слишком сложной для формализации.
В рамках данного подхода характерные элементы синтаксической структуры необходимо описать средствами формальной грамматики, а для поиска во входных данных подстрок, подходящих под это описание, использовать алгоритм синтаксического анализа. Затем извлеченные парсером элементы синтаксической структуры предлагается использовать в процессе обучения нейронных сетей, спроектированных для решения поставленной задачи. Основная идея такого комбинирования формальных грамматик и нейронных сетей заключается в том, что достаточно простая грамматика призвана формализовать только базовые и, вероятно, неполные законы образования синтаксической структуры последовательностей, и предполагается, что нейронной сети будет достаточно этой информации для выявления уже более комплексных, стохастических закономерностей, необходимых для решения некоторой аналитической задачи. Стоит отметить, что в первоначальной формулировке данный подход не ограничивает ни спектр решаемых задач, ни используемые типы грамматик и технологии, а лишь предоставляет архитектуру для обработки определенного класса данных.

Одна из потенциальных областей применения такого подхода является биоинформатика, в частности, различные задачи анализа РНК, где в качестве символьных последовательностей можно рассмотреть нуклеотидные цепочки РНК различных организмов, а в качестве синтаксической структуры --- биологическую вторичную структуру молекулы РНК. В текущей работе исследуется возможность применения описанного выше подхода для решения задачи предсказания вторичной структуры РНК. Далее будет описана разработанная для этого архитектура решения, включающая в себя два основных шага: задание грамматики для поиска характерных элементов вторичной структуры, а затем -- проектирование и обучение нейронных сетей, генерирующих для последовательности РНК максимально близкую к реальной вторичную структуру на основе полученных с помощью парсера данных.

\subsection{Формальная грамматика}
Первичная структура молекулы РНК представляет собой цепочку из нуклеотидов четырех типов (аденин, цитозин, гуанин и урацил), что в терминах синтаксического анализа есть последовательность символов алфавита \{A, C, G, U\}; вторичная же структура образовывается вследствие того, что некоторые участки первичной соединяются между собой, формируя рекурсивную композицию из стемов разного размера и степени вложенности. Обобщенный вид таких стемов может быть формализован средствами достаточно простой контекстно-свободной грамматики, каковой является используемая в данной работе грамматика $G_0$ (рис.~\ref{gram}). Грамматика учитывает только Уотсон-Криковские правила формирования нуклеотидных пар $A-U$, $C-G$ (строка \textbf{5}) и описывает рекурсивные композиции стемов высоты от трех и более (строки \textbf{7-12}). Размер петли внутри стема лежит в пределах от одного до двадцати нуклеотидов, и такую же длину имеют последовательности, расположенные между любыми двумя стемами (строка \textbf{2}). Эти числа были выбраны путем балансирования между следующими двумя соображениями: соответствие эмпирическим наблюдениям биологических данных и адекватность напрямую зависящих от длины и сложности грамматики временных затрат на работу парсера. По тем же причинам в $G_0$ не были включены неканонические нуклеотидные связи, которые могут встречаться в реальной вторичной структуре РНК --- для того, чтобы учесть все возможные пары нуклеотидов, придется ввести большое количество правил, имеющих вероятностную природу. Кроме того, средствами контекстно-свободных грамматик невыразимы псевдоузлы, однако псевдоузел есть комбинация из двух стемов, следовательно, $G_0$, не описывая псевдоузел как единое целое, позволяет, тем не менее, выделить из входной последовательности обе составляющие его подстроки. Здесь становится понятным основное отличие нашего подхода от классического использования формальных грамматик в данной области~\cite{knudsen1999rna,dowell2004evaluation,rivas2000language} --- мы не пытаемся ни смоделировать вторичную структуру целиком, ни описать все возможные закономерности ее образования, но разбиваем ее на простые составные части, синтезировать из которых более сложные объекты предлагается уже с помощью нейронных сетей, что кратно уменьшает интеллектуальные и вычислительные затраты на синтаксический анализ.

\begin{figure}[h]
\begin{Verbatim}[numbers=left,xleftmargin=5mm]
s1: stem<s0>
any_str : any_smb*[1..20]
s0: any_str | any_str stem<s0> s0
any_smb: A | U | C | G
stem1<s>: A s U | G s C | U s A | C s G 
stem2<s>: stem1< stem1<s> >
stem<s>:  
      A stem<s> U 
    | U stem<s> A 
    | C stem<s> G 
    | G stem<s> C 
    | stem1< stem2<s> >  
\end{Verbatim}
\caption{Контекстно-свободная грамматика $G_0$ для описания стемов вторичной структуры РНК}
\label{gram}
\end{figure}

Рассмотрим теперь формальный вид и практический смысл результата работы синтаксического анализатора для вышеописанной грамматики и последовательности РНК некоторого организма. Синтаксический анализ в данном случае используется для поиска всех подстрок входной строки, выводимых из стартового нетерминала $s1$ грамматики $G_0$, иными словами, для поиска тех участков этой строки, которые, в терминах $G_0$, могут свернуться в стемы при формировании вторичной структуры. Формально, для входной строки $w$ парсер заполнит верхнетреугольную булеву матрицу --- матрицу разбора $M_P$, где $M_P[i,j]=1 \iff$ подстрока $w[i..j]$ выводится в $G_0$. Так как интересующие нас стемы должны иметь высоту от трех нуклеотидов, каждому стему высоты $n$ в матрице разбора будет соответствовать цепочка из $n - 2$ единиц. На рис.~\ref{mtrx} представлен результат работы парсера для изображенного на рис.~\ref{rna_a} случая последовательности, сворачивающейся в стем высоты в четыре нуклеотида. Каждой нуклеотидной связи, образующей стем высоты от трех (сплошные линии голубого цвета), соответствует единица в ячейке матрице разбора, при этом очевидно, что  стем высоты три инкапсулирует в себе стемы высоты в два и один нуклеотид, обозначенные на рисунке пунктирными линиями. Помимо уже знакомого нам стема с рис.~\ref{rna_a}, в данной строке парсер обнаружил еще одну выводимую в грамматике подстроку (единица в позиции $[0,11]$): так как мы знаем, что в рассматриваемой цепочке присутствует только один стем, то это может быть как иного рода важная информация о структуре последовательности, так и просто случайный шум.


\begin{figure}[h]
\begin{center}
\centering
\includegraphics[width=10.0cm]{pics/matrix.pdf}
\caption{Матрица разбора для последовательности РНК}
\label{mtrx}
\end{center}
\end{figure} 

Таким образом, матрицы разбора хранят информацию о всех возможных расположениях стемов вторичной структуры во входных последовательностях, однако на данный момент это только теоретические, искусственные объекты, для соотнесения которых с реальными биологическими данными требуется последующая обработка, и об этом будет подробно рассказано в следующем разделе.

\subsection{Нейронная сеть}
На данном этапе поставленная задача конкретизируется до следующей --- разработать нейронную сеть, которая принимает на вход матрицы, полученные синтаксическим анализатором по грамматике $G_0$ для некоторого набора последовательностей РНК, и, обучаясь на вторичных структурах, предоставленных в качестве эталонных для рассматриваемых последовательностей, оптимизирует параметры для преобразования матриц разбора в корректные вторичные структуры. Данный раздел посвящен описанию всех тонкостей этого процесса. 
\subsubsection{Подготовка данных} 
Входные данные для нейросети (матрицы разбора) были описаны в прошлом разделе, и теперь необходимо определить источник и формат эталонных данных. Существуют специализированные биологические базы данных, в которых размещены цепочки РНК различных организмов вместе с их извлеченными из природного материала или же полученными надежными методами вторичными структурами. Такие данные оптимальны для валидации, а, следовательно, и для обучения предсказывающих вторичную структуру алгоритмов. 

Как правило, в базах данных вторичные структуры РНК хранятся в скобочной (dot-bracket) нотации, из которой легко получить еще один классический формат  представления вторичной структуры --- так называемую матрицу контактов (contact map). Матрица контактов описывает наличие или отсутствие связи между каждыми двумя нуклеотидами последовательности: формально, для строки $w$ это верхнетреугольная булева матрица $M_C$, где $M_C[i,j]=1 \iff w[i]$ и $w[j]$ образуют пару во вторичной структуре. Как было описано в прошлом разделе, результат работы парсера на входной строке $w$ --- верхнетреугольная булева матрица $M_P$, где $M_P[i,j]=1 \iff w[i..j]$ свернется в стем по правилам грамматики. Нетрудно проверить, что наличие контакта между нуклеотидами $w[i]$ и $w[j]$ эквивалентно тому факту, что последовательность $w[i..j]$ является стемом, поэтому, несмотря на то, что наше определение вторичной структуры как композиции вложенных стемов не относится к общеупотребимым, матрицу разбора можно также описать как матрицу контактов, формируемых только выразимыми в грамматике элементами. Таким образом, использование матричного представления вторичной структуры при подготовке эталонных данных для нейронной сети представляется самым удобным в свете специфики используемых в качестве входных данных матриц разбора. 

Удобным форматом данных для обучения нейронной сети являются изображения, поэтому мы предлагаем  единицы матриц разбора и матриц контактов заменить на белые пиксели, а нули --- на черные, получив таким образом черно-белые изображения. Матрицы разбора содержат $n - 2$ единицы для каждого стема высоты $n>3$, следовательно, для упрощения обучения нейросети следует добавить для каждого белого пикселя входного изображения еще два белых пикселя в сторону главной диагонали. Кроме того, сама нуклеотидная последовательность РНК может содержать некоторую важную информацию, поэтому предлагается закодировать ее на главной диагонали изображений равноотстающими друг от друга серыми пикселями. 

На рисунке~\ref{struc} продемонстрировано, как для одной и той же последовательности РНК будут выглядеть входное и эталонное изображения нейронной сети, а также показана визуализация соответствующей вторичной структуры. Контакты, относящиеся к трем присутствующим в рассматриваемой цепочке стемам, на всех изображениях выделены голубым, сиреневым и розовым цветами. Данный рисунок является наглядным примером того, что далеко не все найденные парсером стемы будут представлены в реальной вторичной структуре (белые пиксели изображения~\ref{struc_c}). Кроме того, видно, что в сгенерированной синтаксическим анализатором матрице отсутствует несколько эталонных контактов: в данном случае это произошло из-за того, что они были образованы непредусмотренными грамматикой неканоническими нуклеотидными парами. 

\captionsetup[subfigure]{justification=centering}
\begin{figure}[h]
\centering
\begin{subfigure}{.3\textwidth}
  \centering
  \fbox{\includegraphics[width=.9\linewidth]{pics/struct.pdf}}
  \caption{Визуализация вторичной структуры}
  \label{struc_a}
\end{subfigure}%
\begin{subfigure}{.3\textwidth}
  \centering
  \fbox{\includegraphics[width=.9\linewidth]{pics/out.png}}
  \caption{Эталонное изображение нейросети}
  \label{struc_b}
\end{subfigure}
\begin{subfigure}{.3\textwidth}
  \centering
  \fbox{\includegraphics[width=.9\linewidth]{pics/in.png}}
  \caption{Входное \\ изображение нейросети}
  \label{struc_c}
\end{subfigure}
\caption{Примеры представления вторичной структуры}
\label{struc}
\end{figure}

\vspace{2cm}

Таким образом, в рамках данного исследования перед нейронной сетью стоит задача отфильтровать и дополнить матрицу разбора, сгенерировав валидную матрицу контактов, соответствующую максимально близкой к эталонной вторичной структуре.

\subsubsection{Параллельная остаточная архитектура}
Рассмотрим общую модель нейронной сети, разработанной в рамках данной работы. Входными и выходными данными являются изображения, и для решения поставленной задачи необходимо найти достаточно сложные закономерности между элементами данных, находящимися на большом расстоянии друг от друга, поэтому была использована глубокая сверточная сеть. Для оптимизации процесса обучения и повышения скорости сходимости была применена технология остаточных нейронных сетей. В процессе экспериментальных исследований было выявлено, что точность результатов значительно повышает использование $n$ остаточных сетей с одинаковой архитектурой, которые обучаются параллельно на одних и тех же данных, находя в них, по всей видимости, немного разные паттерны, а затем соединяются слоем, подсчитывающим линейную комбинацию их $n$ выходов и передающим ее уже общему остаточному блоку, завершающему обработку данных. Такая новая параллельная архитектура представлена на рис.~\ref{nn}; там же показано, как выглядит типичный остаточный блок (residual unit) нейронной сети, состоящий из пяти сверточных слоев с постепенно убывающими количеством фильтров и размером ядра свертки. В данной работе была использована модель, состоящая из четырех остаточных сетей с пятью одинаковыми блоками в каждой.

\begin{figure}[h]
\begin{center}
\centering
\includegraphics[width=15cm]{pics/nn.pdf}
\caption{Параллельная остаточная нейронная сеть}
\label{nn}
\end{center}
\end{figure} 